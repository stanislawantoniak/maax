<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/** @var $this Zolago_Modago_Block_Review_Form */
?>

<div id="block-review-form" class="row">
    <div class="col-sm-12">
        <?php if ($this->getAllowWriteReviewFlag()): ?>
        <form action="<?php echo Mage::getUrl('review/product/post', array('id' => $this->getProduct()->getId())); ?>" method="post" id="review-form" class="form clearfix" rel="form">
            <?php echo $this->getBlockHtml('formkey'); ?>
            <h4><?php echo $this->escapeHtml($this->getProductInfo()->getName()); ?> - <strong><?php echo $this->__("Add your review"); ?></strong></h4>
            <div class="fieldset">
                <input type="hidden" name="validate_rating" class="validate-rating" value="">

                <fieldset>
                    <?php echo $this->getChildHtml('form_fields_before')?>
                    <?php if(count($this->getRatings())) : ?>
                    <table class="data-table review-summary-table ratings table raty_note" id="product-review-table">
                        <caption><?php echo $this->__("Product ratings"); ?>:</caption>
                        <tbody>
                        <?php foreach($this->getRatings() as $_rating) : ?>
                            <?php
                                $_options = array();
                                foreach ($_rating->getOptions() as $_option) {
                                    $_options[] = $_option->getId();
                                }

                            ?>
                        <tr>
                            <th><?php echo $this->escapeHtml($_rating->getRatingCode()) ?>:</th>
                            <td><div id="<?php echo $this->escapeHtml($_rating->getRatingCode()); ?>_rating" data-number="5" data-score="0" data-score-name="ratings[<?php echo $_rating->getId(); ?>]" data-score-range="<?php echo implode(',', $_options); ?>"></div></td>
                        </tr>
                        <?php endforeach; ?>
                        </tbody>
                    </table>
                    <?php endif; ?>
                </fieldset>

                <fieldset class="col-sm-10">
                    <div class="row">

                        <div class="title form-group">
                            <label for="title" class=""><?php echo $this->__('Summary of Your Review') ?></label>
                            <input type="text" class="form-control" id="title" name="title" data-toggle="tooltip" title="<?php echo $this->__('Summary of Your Review') ?>" value="<?php echo $this->escapeHtml($data->getTitle()) ?>" />

                        </div>
                        <div class="form-group">
                            <label for="review_field" class=""><?php echo $this->__('Review') ?></label>
                            <textarea name="detail" id="review_field" cols="5" rows="3" class="required-entry"><?php echo $this->escapeHtml($data->getDetail()) ?></textarea>
                        </div>

                        <div class="form-group clearfix">
                            <div class="row">
                                <div class="col-sm-3"><label for="recommend_product">Czy polecasz produkt</label></div>
                                <div class="col-sm-9">
                                    <div class="form-group form-radio">
                                        <input type="radio" name="recommend_product" id="recommend_product_yes" class="css-radio" value="1">
                                        <label for="recommend_product_yes" class="css-label">Tak</label>
                                    </div>
                                    <div class="form-group form-radio">
                                        <input type="radio" name="recommend_product" id="recommend_product_no" class="css-radio" value="0">
                                        <label for="recommend_product_no" class="css-label">Nie</label>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="nickname_field form-group clearfix">
                            <div class="row">
                                <div class="col-sm-3"><label for="nickname_field" class=""><?php echo $this->__("Your nickname"); ?></label></div>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control hint" id="nickname_field" name="nickname" data-toggle="tooltip" title="Wprowadź Swój NICK" value="<?php echo $this->escapeHtml($data->getNickname()) ?>" />

                                </div>
                            </div>
                        </div>
                        <button type="submit" title="<?php echo $this->__('Submit Review') ?>" class="button button-primary large pull-right">
                    <span>
                        <span><?php echo $this->__('Submit Review') ?></span>
                    </span>
                        </button>
                    </div>
                </fieldset>

            </div>

        </form>

            <script type="text/javascript">
                jQuery("#review-form").validate({
                    highlight: function(element, errorClass, validClass) {
                        var we = jQuery(element).width()+55;
                        var el = jQuery(element).attr('type');
                        jQuery(element).closest("div").addClass('has-error has-feedback').removeClass('has-success');
                        jQuery(element).closest("div").find('.form-ico-times').remove();

                        jQuery(element).closest("div").not( ".form-checkbox" ).append('<i style="left:'+we+'px; right:auto" class="form-ico-times form-control-feedback "></i>');

                        jQuery(element).closest("div").find('.form-ico-checked').remove();
                    },
                    unhighlight: function(element, errorClass, validClass) {
                        var we = jQuery(element).width()+55;
                        jQuery(element).closest("div").removeClass('has-error').addClass('has-success has-feedback');
                        jQuery(element).closest("div").find('.form-ico-checked').remove();
                        //if (element.attr("type") != "checkbox"){
                        jQuery(element).closest("div").append('<i style="left:'+we+'px; right:auto" class="form-ico-checked form-control-feedback"></i>');
                        //}
                        jQuery(element).closest("div").find('.form-ico-times').remove();
                    },
                    errorPlacement: function(error, element) {
                        if (element.attr("type") == "checkbox"){
                            jQuery(element).closest('div').append(error).hide().slideToggle(300);
                            //error.prepend(element).hide().slideToggle(300);
                        } else {
                            error.insertAfter(element).hide().slideToggle(300);
                        }

                    },
                    success: "valid",
                    errorElement: "span",
                    onfocusout: function (element) {
                        jQuery(element).valid();
                    },
                    onsubmit: function (element) {
                        jQuery(element).valid();
                    },
                    messages: {
                        "nickname" : {
                            required: "<?php echo $this->__("This field is required"); ?>"
                        },
                        "title": {
                            required: "<?php echo $this->__("This field is required"); ?>"
                        },
                        "detail": {
                            required: "<?php echo $this->__("This field is required"); ?>"
                        },
                        "recommend_product": {
                            required: "<?php echo $this->__("This field is required"); ?>"
                        }
                    },
                    rules: {
                        "nickname": {
                            required: true
                        },
                        "title": {
                            required: true
                        },
                        "detail": {
                            required: true
                        },
                        "recommend_product": {
                            required: true
                        }
                    }
                });
            </script>
        <?php else: ?>
            <h4 class="review-nologged" id="review-form">
                <?php echo $this->__('Only registered users can write reviews. Please, <a href="%s">log in</a> or <a href="%s">register</a>', $this->getLoginLink(), Mage::helper('customer')->getRegisterUrl()) ?>
            </h4>
        <?php endif ?>
    </div>
</div>