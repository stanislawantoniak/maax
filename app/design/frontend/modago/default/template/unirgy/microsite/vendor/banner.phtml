<?php
/** @var $this Zolago_Modago_Block_Dropshipmicrositepro_Vendor_Banner */
$sliderType = Zolago_Banner_Model_Banner_Type::TYPE_SLIDER;
$boxType = Zolago_Banner_Model_Banner_Type::TYPE_BOX;

$sliders = $this->getSliders();
$boxes = $this->getBoxes();

if (!empty($sliders) || !empty($boxes)): ?>
    <div id="vendor-banners">
	<?php if($sliders): ?>
		<section id="topSlider">
		<?php foreach($sliders as $slider): ?>
			<?php $slides = !empty($slider['banner_image']) ? unserialize($slider['banner_image']) : array(); ?>
			<?php $captions = !empty($slider['banner_caption'])? unserialize($slider['banner_caption']) : array(); ?>
			<div class="topSlide">
				<div class="topSlideImages">
					<?php foreach($slides as $i => $slide): ?>
						<?php if(!empty($slide['url'])): ?>
							<a href="<?php echo $slide['url']; ?>">
						<?php endif; ?>
						<?php if($i == 1): ?>
							<?php $imageSize = $this->getImageSize($slide['path']); ?>
							<img src="<?php echo rtrim(Mage::getBaseUrl('media'),'/') . $slide['path']; ?>"
							     class="hidden-xs"
								<?php echo is_array($imageSize) ? $imageSize[2] : '' ?> />
						<?php else: ?>
							<?php $imageSize = $this->getImageSize($slide['path']); ?>
							<img src="<?php echo rtrim(Mage::getBaseUrl('media'),'/')  . $slide['path']; ?>"
							     class="visible-xs"
								<?php echo is_array($imageSize) ? $imageSize[2] : '' ?> />
						<?php endif; ?>
						<?php if(!empty($slide['url'])): ?>
							</a>
						<?php endif; ?>
					<?php endforeach; ?>
				</div>
				<div class="topSlideCaptions">
					<?php foreach($captions as $i => $caption): ?>
						<?php if($caption['text']): ?>
							<?php if($caption['url']): ?>
								<a href="<?php echo $caption['url']; ?>">
							<?php endif; ?>
							<span><?php echo $caption['text']; ?> <i class="fa fa-caret-right"></i></span>
							<?php if($caption['url']): ?>
								</a>
							<?php endif; ?>
							<?php if(isset($captions[$i+1])): ?>
								<br />
							<?php endif; ?>
						<?php endif; ?>
					<?php endforeach; ?>
				</div>
			</div>
		<?php endforeach; ?>
		<?php unset($slide); ?>
		<?php unset($caption); ?>
		</section>
	<?php endif; ?>
    <?php if ($boxes) :
	    $boxesCount = 0;
	    foreach($boxes as $box) {
		    $boxesCount += empty($box['banner_image']) ? 0 : 1;
	    }
	    $boxesCount = $boxesCount > 4 ? 4 : $boxesCount;
	    ?>
	    <section id="boxesSlider" data-boxes-amount="<?php echo $boxesCount; ?>"<?php echo $boxesCount > 4 ? ' class="boxesSliderHasArrows"' : ''; ?>>
		    <?php foreach($boxes as $n => $box): ?>
			    <?php $boxe = empty($box['banner_image']) ? array() : unserialize($box['banner_image']); ?>
			    <?php if(!empty($boxe)): ?>
				    <?php foreach($boxe as $i => $b): ?>
					    <?php $path = $b['path']; ?>
					    <?php if($this->imageExists($path)): ?>
						    <div class="boxesSlide">
							    <?php if(!empty($b['url'])): ?>
							    <a href="<?php echo $b['url']; ?>">
								    <?php endif; ?>
								    <?php $imageSize = $this->getImageSize($path); ?>
								    <div class="boxesSlideIn"
								         style="background-image: url('<?php echo $this->getImageUrl($path); ?>')"
								         data-ratio="<?php echo $this->getImageRatio($path); ?>">
								    </div>
								    <?php if(!empty($b['url'])): ?>
							    </a>
						    <?php endif; ?>
						    </div>
					    <?php endif; ?>
				    <?php endforeach; ?>
				    <?php unset($i); ?>
				    <?php unset($b); ?>
				    <?php unset($caption); ?>
			    <?php endif; ?>
		    <?php endforeach; ?>
	    </section>
    <?php endif; ?>
    </div>
<?php endif;?>