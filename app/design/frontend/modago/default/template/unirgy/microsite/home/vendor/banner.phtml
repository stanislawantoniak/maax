<?php
/**
 * Slider and Box block on Gallery Home
 */

/** @var $this Zolago_Modago_Block_Dropshipmicrositepro_Vendor_Banner */
$sliderType = Zolago_Banner_Model_Banner_Type::TYPE_SLIDER;
$boxType = Zolago_Banner_Model_Banner_Type::TYPE_BOX;
$sliders = $this->getSliders();

$landingPageHelper = Mage::helper("zolagocampaign/landingPage");

if($sliders): ?>
<div class="row">
	<section id="topSlider">
		<?php foreach($sliders as $slider): ?>
			<?php $slides = !empty($slider['banner_image']) ? unserialize($slider['banner_image']) : array(); ?>
			<?php $captions = !empty($slider['banner_caption'])? unserialize($slider['banner_caption']) : array(); ?>
			<div class="topSlide">
				<div class="topSlideImages">
					<?php foreach($slides as $i => $slide): ?>

						<?php $urlText = $landingPageHelper->getLandingPageUrl($slider['campaign_id']); ?>
						<?php $campaignUrl = !empty($urlText) ? $urlText: $slider['campaign_url']; ?>

						<?php $slideUrl = !empty($slide['url']) ? $slide['url'] : $campaignUrl; ?>
						<?php if(!empty($slideUrl)): ?><a href="<?php echo $slideUrl; ?>"><?php endif; ?>
						<?php if($i == 1): ?>
							<?php $imageSize = $this->getImageSize($slide['path']); ?>
							<img src="<?php echo rtrim(Mage::getBaseUrl('media'),'/') . $slide['path']; ?>"
							     class="hidden-xs"
							     <?php echo is_array($imageSize) ? $imageSize[3] : '' ?> />
						<?php else: ?>
							<?php $imageSize = $this->getImageSize($slide['path']); ?>
							<img src="<?php echo rtrim(Mage::getBaseUrl('media'),'/')  . $slide['path']; ?>"
							     class="visible-xs"
							     <?php echo is_array($imageSize) ? $imageSize[3] : '' ?> />
						<?php endif; ?>
						<?php if(!empty($slideUrl)): ?></a><?php endif; ?>

						<?php unset($slideUrl); ?>
					<?php endforeach; ?>
				</div>
				<div class="topSlideCaptions">
					<?php foreach($captions as $i => $caption): ?>
						<?php if($caption['text']): ?>
							<?php if($caption['url']): ?>
								<a href="<?php echo $caption['url']; ?>">
							<?php endif; ?>
							<span><?php echo $caption['text']; ?> <i class="fa fa-caret-right"></i></span>
							<?php if($caption['url']): ?>
								</a>
							<?php endif; ?>
							<?php if(isset($captions[$i+1])): ?>
								<br />
							<?php endif; ?>
						<?php endif; ?>
					<?php endforeach; ?>
				</div>
			</div>
		<?php endforeach; ?>
		<?php unset($slide); ?>
		<?php unset($caption); ?>
	</section>
</div>
<?php endif; ?>
<?php $boxes = $this->getBoxes(); ?>
<?php if ($boxes) :
	$boxesCount = 0;
	foreach ($boxes as $key => $box) {
		$boxes[$key]['banner_image'] = empty($box['banner_image']) ? array() : unserialize($box['banner_image'])[1];
		$boxesCount += !empty($boxes[$key]['banner_image']) && $this->imageExists($boxes[$key]['banner_image']['path']) ? 1 : 0;
	}
	$boxesCount = $boxesCount > 4 ? 4 : $boxesCount;
	unset($box);
	?>
<div class="row">
	<section id="boxesSlider" data-boxes-mobile-unslick="1"
	         data-boxes-amount="<?php echo $boxesCount; ?>"<?php echo $boxesCount > 4 ? ' class="boxesSliderHasArrows"' : ''; ?>>
		<?php foreach ($boxes as $n => $box): ?>
			<?php if (!empty($box['banner_image'])):
				$path = $box['banner_image']['path'];
				$url = $box['banner_image']['url']; ?>

				<?php $urlBoxText = $landingPageHelper->getLandingPageUrl($box['campaign_id']); ?>
				<?php $campaignBoxUrl = !empty($urlBoxText) ? $urlBoxText: $box['campaign_url']; ?>

				<?php $boxUrl = !empty($urlBoxText) ? $urlBoxText : $campaignBoxUrl; ?>
				<?php if ($this->imageExists($path)): ?>
					<div class="boxesSlide">
						<?php if (!empty($boxUrl)): ?><a href="<?php echo $boxUrl; ?>"><?php endif; ?>
							<?php $imageSize = $this->getImageSize($path); ?>
							<div class="boxesSlideIn"
							     style="background-image: url('<?php echo $this->getImageUrl($path); ?>')"
							     data-ratio="<?php echo $this->getImageRatio($path); ?>">
							</div>
							<?php if (!empty($boxUrl)): ?></a><?php endif; ?>
					</div>
				<?php endif; ?>
			<?php endif; ?>
			<?php unset($boxUrl); ?>
		<?php endforeach; ?>
	</section>
</div>
<?php endif; ?>