<div id="content" class="container-fluid">
	<div id="checkout" class="row">
		<div class="step step-0 hidden" id="step-0">
			<?php echo $this->getChildHtml("checkout.onepage.guest.address");?>
		</div>
		<div class="step step-1 hidden" id="step-1">
			Step 2
			<button class="btn" id="step-1-prev">Prev</button>
			<button class="btn" id="step-1-submit">Next</button>
		</div>
		<div class="step step-2 hidden" id="step-2">
			Step 3
			<button class="btn" id="step-2-prev">Prev</button>
			<button class="btn" id="step-2-submit">Next</button>
		</div>
	</div>
</div>

<script type="text/javascript">
	(function(){
		var checkout = new Mall.CheckoutGuest();
		
		checkout.setProgressObject(jQuery("#step ol"));
		
		checkout.addStep({
			id: "step-0",
			code: "address",
			onPrepare: function(checkoutObject){
				var self = this;
				this.content.find("#step-0-submit").click(function(){
                    checkoutObject.getActiveStep().collect();
                    return false;
					self.submit();
				})
			},
			isPasswordNotEmpty: function(){
				return this.content.find("[name='billing[customer_password]']").val().length>0;
			},
            collect: function () {
                var form = jQuery("#co-address"),
                    loggedIn = parseInt(form.find("[name='customer_logged_in']").val(), 10),
                    password = form.find("[name='billing[customer_password]']").val();

                // set password confirmation
                if (password.length > 0) {
                    form.find("#billing\\:confirm_password").val(password);
                }
                // set billing data
                form.find("[name='billing[firstname]']").val(form.find("[name='account[firstname]']").val());
                form.find("[name='billing[lastname]']").val(form.find("[name='account[lastname]']").val());

                // copy shipping data if order will be delivered to myself
                if (!form.find("[name='shipping[different_shipping_address]']").is(":checked")) {
                    form.find("#shipping\\:firstname").val(form.find("#account\\:firstname").val());
                    form.find("#shipping\\:lastname").val(form.find("#account\\:lastname").val());
                    form.find("#shipping\\:telephone").val(form.find("#account\\:telephone").val());
                }

                return form.serializeArray();
            }
		});
		
		checkout.addStep({
			id: "step-1",
			code: "deliverypayment",
			onPrepare: function(checkoutObject){
				var self = this;
				this.content.find("#step-1-submit").click(function(){
					self.submit();
				})
				this.content.find("#step-1-prev").click(function(){
					checkoutObject.prev();
				})
			}
		});
		
		checkout.addStep({
			id: "step-2",
			code: "review",
			onPrepare: function(checkoutObject){
				var self = this;
				this.content.find("#step-2-submit").click(function(){
					// Add validation
					checkoutObject.placeOrder()
				});
				this.content.find("#step-2-prev").click(function(){
					checkoutObject.prev();
				})
			}
		});
		
		checkout.init(0);
	})();
</script>