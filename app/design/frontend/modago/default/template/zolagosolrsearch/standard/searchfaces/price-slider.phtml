<?php
/* @var $this Zolago_Solrsearch_Block_Faces_Price */
$solrData = $this->getSolrData ();
$priceFieldName = Mage::helper ( 'solrsearch' )->getPriceFieldName ();

$prefix = 'solrbridge-price';

$ranges = $this->getFacetPriceRanges();

$key = "fq[price]";
$sectionClass = $this->isFilterRolled() ? 'closed' : 'open';
$iconClass = $this->isFilterRolled() ? "fa-chevron-down" : "fa-chevron-up";
$isOptionSelected = $this->getIsRangeActive();

$min = $this->getMinPriceRange();
$max = $this->getMaxPriceRange();

if($isOptionSelected){
	$fromValue = $this->getCurrentStartPrice();
	$toValue = $this->getCurrentEndPrice();
}else{
	$fromValue = $min;
	$toValue = $max;
}


if($toValue==0){
	$toValue = $max;
}

$name = '';
$somethingIsActive = $isOptionSelected;
?>
<?php if ($max > 0 && (int)$max > (int)$min):?>
    <div class="section clearfix" data-xs-rolled="closed" data-lg-rolled="<?php echo $sectionClass; ?>">
        <h3 class="<?php echo $sectionClass; ?>"><span><?php echo $this->__("Price"); ?></span> <i class="fa <?php echo $iconClass; ?>"></i></h3>
        <div class="content"  id="filter_price">
			<?php foreach($ranges as $range) : ?>
			<?php $url = $this->getFacesUrl(array('slider'=>null, 'fq'=>array('price' => $range['value']))); ?>	
            <div class="form-group form-checkbox">

                <input 
					type="checkbox" 
					data-url="<?php echo $url;?>"
					value="<?php echo $range['value'];?>" 
					name="<?php echo $key; ?>" 
					id="<?php echo $this->getItemId($range['value']);?>" 
					class="css-checkbox"
					<?php if ($this->isItemActive($range['value']) && !$isOptionSelected):?> checked="checked"<?php $somethingIsActive = true; endif;?>
				/>
                <label for="<?php echo $this->getItemId($range['value']);?>" class="css-label">
	                <span>
		                <a href="<?php echo $url; ?>"
		                   class="listing-link">
			                <?php echo $range['formatted'] ?>
		                </a>
	                </span>
	                <span class="suffix">
		                (<?php echo $range['count']; ?>)
	                </span>
                </label>
            </div>
			<?php endforeach; ?>
            <div id="od_do" class="clearfix">
                <div class="clearfix">
                    <div id="checkSlider" class="form-group form-checkbox">
						<?php $url = $this->getFacesUrl(array('slider'=>1, 'fq'=>array('price' => $fromValue . " TO " . $toValue))); ?>
                        <input 
							type="checkbox" 
							name="<?php echo $key; ?>" 
							value="<?php echo ($isOptionSelected) ? $fromValue . " TO " . $toValue  : "";?>"
							id="filter_slider" 
							class="css-checkbox" 
							<?php if($isOptionSelected) : ?>checked="checked"<?php endif; ?>
						/>
                        <label for="filter_slider" class="css-label"><a class="listing-link" href="<?php echo $url; ?>"></a></label>
                    </div>
                    <div class="form-horizontal">
                        <div class="form-group">
                            <input type="text" id="zakres_min" value="<?php echo $fromValue; ?>" /><label for="zakres_od"> - </label>
                        </div>
                    </div>
                    <div class=" form-horizontal">
                        <div class="form-group">
                            <input id="zakres_max" value="<?php echo $toValue; ?>" type="text" />
                        </div>
                    </div>
                    <div class="form-action">
                        <div class="form-group">
                            <input type="submit" class="btn black pull-right filter-price-range-submit" data-filter-type="price" value="OK"/>
                        </div>
                    </div>
                </div>
                <div id="slider-range" data-min="<?php echo $min;?>" data-max="<?php echo ceil($max);?>"></div>

            </div><br />

            <div class="action clear clearfix <?php if(!$isOptionSelected && !$this->isFilterActive("price")): ?>hidden<?php endif; ?>">
                <a href="<?php echo $this->getRemoveAllUrl("price") ?>" class="button button-third clear"><?php echo $this->__("Clear"); ?></a>
            </div> 
        </div>
        <?php if($somethingIsActive) : ?>
            <div class="content-xs" id="filter_price_xs" data-content="xs">
                <div class="active-filter">
                    <?php foreach($ranges as $range) : ?>
                        <?php if ($this->isItemActive($range['value']) && !$isOptionSelected): ?>
                                <a href="<?php echo $this->getRemoveFacesUrl("price", $range['value']); ?>"
                                   class="active-filter-label"
                                   data-input="<?php echo $this->getItemId($range['value']); ?>">
                                    <?php echo $range['formatted']; ?><i class="fa fa-times"></i>
                                   </a>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </div>
                <div class="action clear clearfix <?php if(!$isOptionSelected && !$this->isFilterActive("price")): ?>hidden<?php endif; ?>">
                    <a href="<?php echo $this->getRemoveAllUrl("price") ?>" class="button button-third clear"><?php echo $this->__("Clear"); ?></a>
                </div>
            </div>
        <?php endif; ?>
    </div>
    <script type="text/javascript">
        Mall.listing.setCurrentPriceRange(<?php echo $fromValue; ?>, <?php echo $toValue; ?>);
    </script>
<?php endif;?>

<script type="text/javascript">
    Mall.translate.add("price-filter-not-valid", "<?php echo $this->__("Prices in filter are not valid."); ?>");
</script>
