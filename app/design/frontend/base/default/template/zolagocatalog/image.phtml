<link rel="stylesheet" media="screen and (min-width: 750px) and (max-width: 990px)" href="/skin/frontend/base/default/css/800.css" />
<?php $_helper = Mage::helper("zolagocatalog"); ?>

<div class="container">
    <!--=== Page Header ===-->
    <div class="page-header">
        <div class="page-title">
            <h3><?php echo $_helper->__("Mass Image");?></h3>
        </div>
    </div>
    <div class="tabbable tabbabble-custom">
        <ul class="nav nav-tabs" style="margin-top:6px">
            <li class="" style="float:left;">
                <a name="tmp"></a>
            </li>
            <li class="active" style="float:left">
                <a data-toggle="tab" href="#tab_1_1"><?php echo Mage::helper('zolagocatalog')->__('Images');?></a>
            </li>
            <li class="" style="float:left;">
                <a data-toggle="tab" href="#tab_1_2"><?php echo Mage::helper('zolagocatalog')->__('Add');?></a>
            </li>


        </ul>
        <div class="tab-content">
            <div id="tab_1_1" class="tab-pane active">
                <?php echo $this->getChildHtml("image_list");?>
            </div>

            <div id="tab_1_2" class="tab-pane">
                <?php echo $this->getChildHtml("image_queue");?>
            </div>

        </div>
    </div>
</div>
<script type="text/javascript">
    jQuery(function ($) {
        $(".vendor-image").dragsort({
            dragSelector: "li",
            placeHolderTemplate: "<li class='image-placeholder'></li>",
            dragEnd: function () {

                var images = [];
                $.each($(this).closest("ul.vendor-image").find("li"), function (i, li) {
                    images.push($(li).data("value"))
                });

                $.ajax({
                    url: '<?php echo Mage::getUrl("udprod/vendor_image/changeProductImagesOrder")?>',
                    type: "POST",
                    data: {product: $(this).data("product"), images: images}
                });
            },
            dragBetween: false
        });
        $(".vendor-image-zoom").click(function (e) {
            console.log("ZOOM");
            e.preventDefault();
            var controlLink = $(this);
            var parentContainer = controlLink.closest("li");
            var productId = parentContainer.data("product");
            var productName = parentContainer.data("productname");
            var fullImage = parentContainer.data("image");

            var img = $('<img />', {
                id: 'vendor_image_' + productId,
                src: fullImage,
                alt: productName
            });

            var modal = $("#vendorImageZoom");
            modal.find(".modal-header .modal-title").html(productName);
            modal.find(".modal-body").html(img);
            modal.modal('show');
        });
        $(".vendor-image-availability").click(function (e) {
            console.log("AVAILABILITY");
            e.preventDefault();
            var availabilityLink = $(this);
            var parentContainer = availabilityLink.closest("li");
            var imageToDisable = (parentContainer.hasClass("need-to-check") ? 0 : 1);


            parentContainer.find(".vendor-image-refresh").show();
            $.ajax({
                url: '<?php echo Mage::getUrl("udprod/vendor_image/toggleAvailabilityProductImage")?>',
                type: "POST",
                data: {
                    action: imageToDisable,
                    product: parentContainer.data("product"),
                    image_value: parentContainer.data("value")
                },
                success: function(result){
                    parentContainer.find(".vendor-image-refresh").hide();
                    if(imageToDisable){
                        console.log("Disabled");
                        availabilityLink
                            .attr("title","<?php echo Mage::helper("zolagocatalog")->__("Enable"); ?>")
                            .html("<i class='icon-circle'></i>");
                        parentContainer.addClass("need-to-check")
                            .tooltip({
                                title: "<?php echo Mage::helper("zolagocatalog")->__("Image to check"); ?>"
                            })
                            .find("img").css({"opacity": "0.5"});
                    } else {
                        console.log("Enabled");
                        availabilityLink
                            .attr("title","<?php echo Mage::helper("zolagocatalog")->__("Disable"); ?>")
                            .html("<i class='icon-ban-circle'></i>");
                        parentContainer.removeClass("need-to-check").tooltip('disable')
                            .find("img").css({"opacity": "1"});
                    }

                }
            });
        });



        //Clear modal on hide
        $('#vendorImageZoom').on('hidden.bs.modal', function () {
            $(this).find(".modal-header .modal-title").html("");
            $(this).find(".modal-body").html("");
        })

    });
</script>
<script type="text/javascript">
    jQuery(document).ready(function(){
        jQuery('.need-to-check').tooltip({
            title: "<?php echo Mage::helper("zolagocatalog")->__("Image to check"); ?>"
        }).find("img").css({"opacity": "0.5"});
    })
</script>
<!-- Modal For Image Zoom -->
<div id="vendorImageZoom" class="modal fade" role="dialog">
    <div class="modal-dialog modal-md">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    <?php echo Mage::helper("zolagocatalog")->__("Close"); ?>
                </button>
            </div>
        </div>

    </div>
</div>
