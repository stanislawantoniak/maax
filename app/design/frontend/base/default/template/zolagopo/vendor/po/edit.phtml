<?php /* @var $this Zolago_Po_Block_Vendor_Po_Edit */ ?>
<?php $_po = $this->getPo(); ?>
<?php $_shipping = $this->getShippingMethod();?>
<?php $_alert = $_po->getAlert();?>
<?php $_comments = $_po->getVendorCommentsCollection(); ;?>
<div class="container">
	<!--=== Page Header ===-->
	<div class="page-header">
		<div class="page-title">
			<h3><?php echo Mage::helper("zolagopo")->__("Order #%s", $_po->getIncrementId());?></h3>
			<span><?php echo Mage::helper("zolagopo")->__("Order details");?></span>
		</div>
	</div>
</div>
<div class="container">
	<div class="row">
		<div class="col-md-4">
			<div class="widget box">
				<div class="widget-header"> 
					<h4>
						<i class="icon-info"></i> 
						<?php echo Mage::helper("zolagopo")->__("General");?>
					</h4>
					<div class="toolbar no-padding"> 
						<div class="btn-group"> 
							<span class="btn btn-xs">
								<i class="icon-retweet"></i> 
								<?php echo Mage::helper("zolagopo")->__("Change POS");?>
							</span> 
						</div> 
					</div>
				</div>
				<div class="widget-content orders<?php if($_alert):?> with-alert<?php endif;?>">
					<dl class="dl-horizontal dl-z"> 
						<dt><?php echo Mage::helper("zolagopo")->__("Number");?>:</dt> 
						<dd><?php echo $_po->getIncrementId();?></dd> 
						<dt><?php echo Mage::helper("zolagopo")->__("Status");?>:</dt> 
						<dd>
							<div class="btn-group"> 
								<button class="btn btn-xs dropdown-toggle" data-toggle="dropdown"> 
									<?php echo $this->getCurrentStatus($_po);?> <span class="caret"></span> 
								</button> 
								<ul class="dropdown-menu"> 
									<?php foreach($this->getAllowedStatusesForPo($_po) as $key=>$status):?>
									<li><a href="#<?php echo $key;?>"><?php echo $status;?></a></li> 
									<?php endforeach;?>
								</ul> 
							</div>
						</dd> 
						<dt><?php echo Mage::helper("zolagopo")->__("Order date");?>:</dt> 
						<dd><?php echo Mage::helper('core')->formatDate($_po->getCreatedAt(), 'medium')?></dd> 
						<dt><?php echo Mage::helper("zolagopo")->__("Max. order date");?>:</dt> 
						<dd><?php echo Mage::helper('core')->formatDate($_po->getCreatedAt(), 'medium')?></dd> 
						<?php if($_po->getPos()):?>
						<dt><?php echo Mage::helper("zolagopo")->__("POS");?>:</dt> 
						<dd><?php echo $_po->getPos()->getName(); ?></dd> 
						<?php endif;?>
					</dl>
					<?php if($_alert):?>
					<p class="alert alert-danger fade in"><?php echo $this->getAlertText($_alert);?></p>
					<?php endif;?>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="widget box">
				<div class="widget-header"> <h4><i class="icon-usd"></i> <?php echo Mage::helper("zolagopo")->__("Payment");?></h4> </div>
				<div class="widget-content orders<?php if($_alert):?> with-alert<?php endif;?>">
					<dl class="dl-horizontal dl-z"> 
						<dt><?php echo Mage::helper("zolagopo")->__("Payment status");?>:</dt> 
						<dd>Op≈Çacono</dd> 
						<dt><?php echo Mage::helper("zolagopo")->__("Paid");?>:</dt> 
						<dd>1 034,00 PLN</dd> 
						<dt><?php echo Mage::helper("zolagopo")->__("Debt");?>:</dt> 
						<dd> 34,00 PLN</dd> 
					</dl>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="widget box">
				<div class="widget-header"> 
					<h4>
						<i class="icon-phone"></i> 
							<?php echo Mage::helper("zolagopo")->__("Contact");?>
					</h4> 
					<div class="toolbar no-padding"> 
						<div class="btn-group"> 
							<span class="btn btn-xs">
								<i class="icon-comment "></i> 
								<?php echo Mage::helper("zolagopo")->__("Compose");?>
							</span> 
							
						</div> 
					</div>
				</div>
				<div class="widget-content orders<?php if($_alert):?> with-alert<?php endif;?>">
					<dl class="dl-horizontal dl-z"> 
						<dt><?php echo Mage::helper("zolagopo")->__("Fullname");?>:</dt> 
						<dd><?php echo $this->escapeHtml($_po->getBillingAddress()->getName());?></dd> 
						<dt><?php echo Mage::helper("zolagopo")->__("Phone");?>:</dt> 
						<dd><?php echo $this->escapeHtml($_po->getBillingAddress()->getTelephone());?></dd> 
						<dt><?php echo Mage::helper("zolagopo")->__("Messages / new");?></dt> 
						<dd>
							120 / <span class="label label-danger">2</span><br/>
							<a href="#"><?php echo Mage::helper("zolagopo")->__("View all messages");?></a>
						</dd> 
					</dl>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="container">
	<div class="row">
		<div class="col-md-12">
			<div class="widget box">
				<div class="widget-header"> 
					<h4>
						<i class="icon-list"></i> 
						<?php echo Mage::helper("zolagopo")->__("Order items");?>
					</h4> 
					<div class="toolbar no-padding"> 
						<div class="btn-group"> 
							<span class="btn btn-xs">
								<i class="icon-ok"></i>
								<?php echo Mage::helper("zolagopo")->__("Confirm stock");?>
							</span> 
							
							<button class="btn btn-xs" >
								<i class="icon-plus-sign"></i>
								<?php echo Mage::helper("zolagopo")->__("Add new item");?>
							</button>
						</div> 
					</div>
				</div>
				
				<div class="widget-content  no-padding">
					<table id="items" class="table table-striped table-bordered table-checkable table-hover foot-empty-cells">
						<colgroup>
							<col width="50px"/>
							<col width="50px"/>
							<col width="150px"/>
							<col/>
							<col width="50px"/>
							<col width="100px"/>
							<col width="100px"/>
							<col width="100px"/>
							<col width="100px"/>
							<col width="85px"/>
						</colgroup>
						<thead>
							<tr>
								<th class="align-center"><?php echo Mage::helper("zolagopo")->__("Check");?></th>
								<th class="align-right"><?php echo Mage::helper("zolagopo")->__("LP");?></th>
								<th><?php echo Mage::helper("zolagopo")->__("SKU");?></th>
								<th><?php echo Mage::helper("zolagopo")->__("Product");?></th>
								<th class="align-right"><?php echo Mage::helper("zolagopo")->__("Qty");?></th>
								<th class="align-right"><?php echo Mage::helper("zolagopo")->__("Price incl. tax");?></th>
								<th class="align-right"><?php echo Mage::helper("zolagopo")->__("Discount");?></th>
								<th class="align-right"><?php echo Mage::helper("zolagopo")->__("Final price");?></th>
								<th class="align-right"><?php echo Mage::helper("zolagopo")->__("POS Qty");?></th>
								<th></th>
							</tr>
						</thead>
						<tfoot>
							<tr>
								<td colspan="3" rowspan="2" style="border-bottom: 0; vertical-align: middle;">
									<i class="icon-checked-action"></i>
									<button class="btn" id="split" disabled="disabled">
										<i class=" icon-unlink"></i>
										<?php echo Mage::helper("zolagopo")->__("Split order");?>
									</button>
								</td>
								<?php if($_shipping):?>
								<td colspan="2"><?php echo Mage::helper("zolagopo")->__("Shipping");?>: <?php echo $this->escapeHtml($this->getMethodName($_shipping));?></td>
								<td class="align-right"><?php echo Mage::helper("core")->currency($_po->getBaseShippingAmountInclTax(), true, false);?></td>
								<td class="align-right"><?php echo Mage::helper("core")->currency($_po->getShippingDiscountInclTax(), true, false);?></td>
								<td class="align-right"><?php echo Mage::helper("core")->currency($_po->getFinalShippingAmountInclTax(), true, false);?></td>
								<?php else:?>
								<td colspan="5"></td>
								<?php endif;?>
								<td ></td>
								<td>
									<?php if($_shipping):?>
									<button class="btn btn-xs bs-tooltip" data-placement="top" title="<?php echo Mage::helper("zolagopo")->__("Edit item");?>" >
										<i class="icon-pencil"></i>
									</button>
									<button class="btn btn-xs btn-notification bs-tooltip" data-placement="top" title="<?php echo Mage::helper("zolagopo")->__("Remove item");?>" data-layout="top" data-type="confirm" data-text="<?php echo Mage::helper("zolagopo")->__("Do you want to remove this item?");?>" data-modal="true">
										<i class="icon-remove"></i>
									</button>
									<?php endif; ?>
								</td>
							</tr>
							<tr>
								<td colspan="4"><strong> <?php echo Mage::helper("zolagopo")->__("Total");?></strong></td>
								<td class="align-right"><strong><?php echo Mage::helper("core")->currency($_po->getGrandTotalInclTax());?></strong></td>
								<td colspan="2">
								</td>
							</tr>
						</tfoot>
						<tbody>
							<?php $i=0;?>
							<?php foreach($_po->getAllItems() as $_key=>$_item): ?>
								<?php if(!$_item->getOrderItem()->getParentItemId()):?>
									<?php echo $this->getItemRedener($_item)->setLp(++$i)->toHtml();?>
								<?php endif;?>
							<?php endforeach;?>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-3">
			<div class="widget box">
				<div class="widget-header">
					<h4>
						<i class=" icon-envelope"></i> 
						<?php echo Mage::helper("zolagopo")->__("Shipping address");?>
					</h4>			
					<div class="toolbar no-padding"> 
						<div class="btn-group"> 
							<span class="btn btn-xs"><i class="icon-pencil"></i></span> 
						</div> 
					</div>
				</div>
				<div class="widget-content bottom-info">
					<?php echo Mage::helper('udropship')->formatCustomerAddress($_po->getShippingAddress(), 'html', $this->getVendor()) ?>
				</div>
			</div>
		</div>
		<div class="col-md-3">
			<div class="widget box">
				<div class="widget-header">
					<h4>
						<i class="icon-file"></i> 
						<?php echo Mage::helper("zolagopo")->__("Sale document");?>
					</h4>
					<div class="toolbar no-padding"> 
						<div class="btn-group"> 
							<span class="btn btn-xs"><i class="icon-pencil"></i></span> 
						</div> 
					</div>
				</div>
				<div class="widget-content bottom-info">
					<?php echo Mage::helper('udropship')->formatCustomerAddress($_po->getBillingAddress(), 'html', $this->getVendor()) ?>
				</div>
			</div>
		</div>
		<div class="col-md-6">
			<div class="widget box">
				<div class="widget-header">
					<h4>
						<i class="icon-plane"></i> 
						<?php echo Mage::helper("zolagopo")->__("Shipment");?>
					</h4>	
				</div>
				<div class="widget-content bottom-info shipping-info">
					<?php if(!$_shipping):?>
					<div class="row">
						<div class="col-md-6">
							<dl class="dl-horizontal dl-z">
								<dt><?php echo Mage::helper("zolagopo")->__("Status");?>:</dt>
								<dd><?php echo Mage::helper("zolagopo")->__("Not send");?></dd>
								<dt><?php echo Mage::helper("zolagopo")->__("Method");?>:</dt>
								<dd><?php echo Mage::helper("zolagopo")->__("Carrier");?></dd>
								<dt><?php echo Mage::helper("zolagopo")->__("Letter no.");?>:</dt>
								<dd><?php echo Mage::helper("zolagopo")->__("123123233");?></dd>
							</dl>
						</div>
						<div class="col-md-6">
							<dl class="dl-horizontal dl-z">
								<dt><?php echo Mage::helper("zolagopo")->__("Status");?>:</dt>
								<dd><?php echo Mage::helper("zolagopo")->__("Not send");?></dd>
								<dt><?php echo Mage::helper("zolagopo")->__("Method");?>:</dt>
								<dd><?php echo Mage::helper("zolagopo")->__("Carrier");?></dd>
								<dt><?php echo Mage::helper("zolagopo")->__("Letter no.");?>:</dt>
								<dd><?php echo Mage::helper("zolagopo")->__("123123233");?></dd>
							</dl>
						</div>
					</div>
					<div class="clearfix"></div>
					<?php else:?>
					<div class="align-center">
						<button class="btn btn-primary"><?php echo Mage::helper("zolagopo")->__("Generate shipping letter");?></button>
					</div>
					<?php endif;?>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12 comments">
			<div class="widget box">
				<div class="widget-header">
					<h4>
						<i class="icon-comments-alt"></i> 
						<?php echo Mage::helper("zolagopo")->__("Operiation history");?>
					</h4>			
					<div class="toolbar no-padding"> 
						<div class="btn-group"> 
							<span class="btn btn-xs"><i class="icon-comment"></i> <?php echo Mage::helper("zolagopo")->__("Add comment");?></span> 
						</div> 
					</div>
				</div>
				<div class="widget-content">
					<?php if (count($_comments)): ?>
					<dl class="dl-horizontal">
						<?php foreach ($_comments as $_c): ?>
						<dt>
							<?php echo Mage::helper('core')->formatDate($_c->getCreatedAt(), 'medium', true) ?>
							<br/>
							<small><?php echo$_c->getUdropshipStatus();?></small>
						</dt>
						<dd><?php echo $this->htmlEscape($_c->getComment());?></dd>
						
						<?php endforeach ?>
					</dl>
					<?php else:?>
					<small><?php echo Mage::helper("zolagopo")->__("No comments currently added");?></small>
					<?php endif ?>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	jQuery(function($){
		var items = $("#items"),
			checkboxes = items.find(".checker :checkbox"),
			splitBtn = $("#split");
			
		checkboxes.change(function(el){
			var checkLen = checkboxes.filter(":checked").length;
			splitBtn.attr("disabled", checkLen==checkboxes.length || !checkLen);
		});
		
		$('.btn-notification').click(function() {
			var self = $(this);
			noty({
				text: self.data('text'),
				type: self.data('type'),
				modal: self.data('modal'),
				layout: self.data('layout'),
				buttons: (self.data('type') != 'confirm') ? false : [
					{
						addClass: 'btn btn-primary', text: 'Ok', onClick: function($noty) {
							$noty.close();
							noty({force: true, timeout: 2000, text: 'You clicked "Ok" button', type: 'success', layout: self.data('layout')});
						}
					}, {
						addClass: 'btn btn-danger', text: 'Cancel', onClick: function($noty) {$noty.close();}
					}
				]
			});

			return false;
		});
	});
</script>