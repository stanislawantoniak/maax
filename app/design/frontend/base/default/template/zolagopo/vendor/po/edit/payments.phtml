<?php /* @var $this Zolago_Po_Block_Vendor_Po_Edit_Payments */ ?>
<?php $_hlp = Mage::helper("zolagopo"); ?>
<?php $paymentDetails = $this->getData('payment_details'); ?>
<?php $overpayDetails = $this->getData('overpay_details'); ?>
<?php $_po = $this->getData('po'); ?>

<!-- Modals comment -->
<div class="modal fade" id="paymentsModal">
    <div class="modal-dialog" style="width: 800px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title"><?php echo $_hlp->__("Payment details"); ?></h4>
            </div>
            <div class="modal-body">
                <?php if($paymentDetails->getSize() > 0): ?>
                    <table class="table table-striped table-bordered table-checkable table-hover foot-empty-cells">
                        <thead>
                            <tr>
                                <th colspan="5" style="text-align: center;"><?php echo $_hlp->__("Payments"); ?></th>
                            </tr>
                            <tr>
                                <th><?php echo $_hlp->__("Transaction"); ?></th>
                                <th><?php echo $_hlp->__("Date"); ?></th>
                                <th><?php echo $_hlp->__("Details"); ?></th>
                                <th><?php echo $_hlp->__("Operator"); ?></th>
                                <th><?php echo $_hlp->__("Amount"); ?></th>
                            </tr>
                        </thead>
                        <tbody>
                        <?php foreach ($paymentDetails as $paymentDetail): ?>
                            <tr>
                                <td><?php echo $paymentDetail->getTxnId(); ?></td>
                                <td><?php echo $paymentDetail->getCreatedAt(); ?></td>
                                <td><?php echo $paymentDetail->getComment(); ?></td>
                                <td>
                                    <?php $operatorId = $paymentDetail->getOperatorId(); ?>
                                    <?php if (is_null($operatorId)): ?>
                                        <?php echo $_hlp->__("Automat"); ?>
                                    <?php else: ?>
                                        <?php echo $paymentDetail->getFirstname(); ?>&nbsp;
                                        <?php echo $paymentDetail->getLastname(); ?>
                                    <?php endif; ?>
                                </td>
                                <td>
                                    <?php echo Mage::helper('core')
                                        ->currency($paymentDetail->getAllocationAmount(), true, false); ?>
                                </td>
                            </tr>
                        <?php endforeach; ?>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><strong><?php echo $_hlp->__("Final price");?></strong></td>
                            <td>
                                <strong><?php echo Mage::helper("core")->currency($_po->getGrandTotalInclTax());?></strong>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><strong><?php echo $_hlp->__("Paid");?></td>
                            <td>
                                <strong><?php echo $_po->getCurrencyFormattedAmount($_po->getPaymentAmount()); ?></strong>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td><strong><?php echo $_hlp->__("Difference:"); ?></strong></td>
                            <td><strong>
                                <?php
                                $debtAmount = $_po->getDebtAmount();
                                echo $debtAmount > 0 ? "+" : "";
                                echo $_po->getCurrencyFormattedAmount($debtAmount);
                                ?></strong>
                            </td>
                        </tr>

                        </tbody>
                    </table>
                    <?php if ($_po->getDebtAmount() > 0): ?>
                        <div class="row">
                            <div class="col-xs-12" style="padding-bottom: 6px;">
                                <a class="btn btn-primary" data-toggle="modal"
                                   href="<?php echo $this->getCreateOverpaymentUrl("createOverpayment"); ?>">
                                    <?php echo $_hlp->__("Create overpayment"); ?>
                                </a>
                            </div>
                        </div>
                    <?php endif; ?>
                <?php endif; ?>

                <?php if($overpayDetails->getSize() > 0): ?>
                    <table class="table table-striped table-bordered table-checkable table-hover foot-empty-cells">
                        <thead>
                            <tr>
                                <th colspan="7" style="text-align: center;"><?php echo $_hlp->__("Overpayments"); ?></th>
                            </tr>
                            <tr>
                                <th><?php echo $_hlp->__("Transaction"); ?></th>
                                <th><?php echo $_hlp->__("Date"); ?></th>
                                <th><?php echo $_hlp->__("Order ID"); ?></th>
                                <th><?php echo $_hlp->__("Details"); ?></th>
                                <th><?php echo $_hlp->__("Operator"); ?></th>
                                <th><?php echo $_hlp->__("Amount"); ?></th>
                                <th><?php echo $_hlp->__("Allocate"); ?></th>
                            </tr>
                        </thead>
                        <tbody>
                        <?php foreach ($overpayDetails as $overpayDetail): ?>
                            <tr>
                                <td><?php echo $overpayDetail->getTxnId(); ?></td>
                                <td><?php echo $overpayDetail->getCreatedAt(); ?></td>
                                <td><?php echo $overpayDetail->getIncrementId(); ?></td>
                                <td><?php echo $overpayDetail->getComment(); ?></td>
                                <td>
                                    <?php $operatorId = $overpayDetail->getOperatorId(); ?>
                                    <?php if (is_null($operatorId)): ?>
                                        <?php echo $_hlp->__("Automat"); ?>
                                    <?php else: ?>
                                        <?php echo $overpayDetail->getFirstname(); ?>&nbsp;
                                        <?php echo $overpayDetail->getLastname(); ?>
                                    <?php endif; ?>
                                </td>
                                <td>
                                    <?php echo Mage::helper('core')
                                        ->currency($overpayDetail->getAllocationAmount(), true, false); ?>
                                </td>
                                <td>
                                    <a class="btn btn-primary" data-toggle="modal"
                                       href="#<?php //echo $this->getCreateOverpaymentUrl("yyy"); ?>">
                                        <?php echo $_hlp->__("[dev]"); ?></a>
                                </td>
                            </tr>
                        <?php endforeach; ?>
                        </tbody>
                    </table>
                <?php endif; ?>
            </div>
        </div>
    </div>
</div>
