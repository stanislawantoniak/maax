<?php /* @var $this Zolago_Rma_Block_Vendor_Rma_Edit */ ?>
<?php $_helper = Mage::helper("zolagorma");?>
<?php $_rma = $this->getModel();?>
<?php $_po = $_rma->getPo();?>
<?php $_pos = $_po->getPos();?>
<?php $_rmaShipment = $_rma->getShipment(); ?>
<?php $_order= $_po->getOrder(); ?>
<?php $_vendor = $_rma->getVendor(); ?>
<?php $_tracking = $this->getTracking($_rmaShipment);?>
<?php $_billingAddress = $_rma->getBillingAddress();?>
<?php $_shippingAddress = $_rma->getShippingAddress();?>
<?php $_comments = $_rma->getVendorCommentsCollection(); ?>
<?php $_statuses = $_helper->getVendorRmaStatuses(); ?>
<?php $_currentStatusId = $_rma->getRmaStatus(); ;?>

<div class="container">
	<!--=== Page Header ===-->
	<div class="page-heading row">
		<div class="col-lg-6">
			<h3>
				<?php echo $_helper->__("Details of RAM notification no. #%s", $_rma->getIncrementId());?>
			</h3>
		</div>
		<div class="main-actions align-right col-md-6">
		
		</div>
	</div>
</div>
<div class="container">
	<div class="row">
		<div class="col-md-4">
			<div class="widget box">
				<div class="widget-header"> 
					<h4>
						<i class="icon-info"></i> 
						<?php echo $_helper->__("RMA Data");?>
					</h4>
				</div>
				<div class="widget-content rma">
					<dl class="dl-horizontal dl-z"> 
						<dt><?php echo $_helper->__("Notification status.");?>:</dt> 
						<dd><?php echo $this->escapeHtml($_rma->getRmaStatusName());?></dd> 
						<dt><?php echo $_helper->__("Notification date");?>:</dt> 
						<dd><?php echo $this->formatDate($_rma->getCreatedAt());?></dd> 
						<dt><?php echo $_helper->__("Reaction deadline");?>:</dt> 
						<dd><?php echo $this->formatDate();?> [dev]</dd> 
						<dt><?php echo $_helper->__("Store");?>:</dt> 
						<dd><?php echo $this->escapeHtml($_vendor->getVendorName())?></dd> 
						<dt><?php echo $_helper->__("Return payment");?>:</dt> 
						<dd>
							<div class="btn-group" id="status-holder"> 
								<button class="btn btn-xs dropdown-toggle" data-toggle="dropdown"> 
									<?php echo $this->escapeHtml('Not paid');?> <span class="caret"></span> 
								</button> 
								<ul class="dropdown-menu"> 
									<li><a class="btn-notification" data-placement="top" data-ok-url="<?php echo $this->getRmaUrl("directPayment");?>" data-layout="top" data-type="confirm" data-text="<?php echo $_helper->__("You are about to direct payment. Are you sure?");?>" data-modal="true" href="#"><?php echo $_helper->__("Direct payment");?></a></li> 								
								</ul> 
							</div>
						</dd> 
						<dt><?php echo $_helper->__("Shipping letter no.");?>:<br/><small class="text-muted" style="font-weight: normal;">(<?php echo $_helper->__("Customer return");?>)</small></dt> 
						<dd><?php echo "1212312312313";?> [dev]</dd> 
					</dl>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="widget box">
				<div class="widget-header"> 
					<h4>
						<i class="icon-shopping-cart"></i> 
						<?php echo $_helper->__("Order data");?>
					</h4>
				</div>
				<div class="widget-content rma">
					<dl class="dl-horizontal dl-z"> 
						<dt><?php echo $_helper->__("Order No.");?>:</dt> 
						<dd><a href="<?php echo $this->getPoUrl('edit');?>">#<?php echo $_po->getIncrementId();?></a></dd> 
						<dt><?php echo $_helper->__("Order date");?>:</dt> 
						<dd><?php echo $this->formatDate($_po->getCreatedAt());?></dd> 
						<dt><?php echo $_helper->__("Shipment date");?>:</dt> 
						<dd><?php echo $_rmaShipment ? $this->formatDate($_rmaShipment->getCreatedAt()) : $_helper->__("N/A");?></dd> 
						<dt><?php echo $_helper->__("Shipment letter");?>:</dt> 
						<dd>
							<?php if($_tracking):?>
								<!-- <a href="<?php echo $this->getTrackingUrl($_tracking);?>"> -->
									<?php echo $this->escapeHtml($_tracking->getTrackNumber()) ;?>
								<!-- </a> -->
							<?php else: ?>
								<?php echo $_helper->__("N/A");?>
							<?php endif ?>
						</dd> 
						<dt><?php echo $_helper->__("Recived date");?>:</dt> 
						<dd><?php echo ($_tracking && $_tracking->getShippedDate()) ? $this->formatDate($_tracking->getShippedDate()) : $this->__("N/A");?></dd>
						<dt><?php echo $_helper->__("POS");?>:</dt> 
						<dd><?php echo $this->escapeHtml($_pos->getName())?></dd>
						<dt><?php echo $_helper->__("Payment");?>:</dt> 
						<dd><?php echo $this->getPaymentText($_order); ?></dd>
					
					</dl>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="widget box">
				<div class="widget-header"> 
					<h4>
						<i class="icon-user"></i> 
						<?php echo $_helper->__("Customer data");?>
					</h4>
					<div class="toolbar no-padding"> 
						<div class="btn-group"> 
							<span data-toggle="modal" data-target="#editShippingAddressModal" class="btn btn-xs">
								<i class="icon-pencil"></i> 
								<?php echo $_helper->__("ZmieÅ„ dane");?>
							</span> 
						</div> 
					</div>
				</div>
				<div class="widget-content rma">
					<dl class="dl-horizontal dl-z"> 
						<dt><?php echo $_helper->__("Fullname");?>:</dt> 
						<dd><?php echo $this->escapeHtml($_billingAddress->getName());?></dd> 
						<dt><?php echo $_helper->__("Address");?>: <?php echo $_shippingAddress->getId();?></dt> 
						<dd><?php echo Mage::helper('udropship')->formatCustomerAddress($_shippingAddress, 'html', $_po->getVendor());?> </dd> 
						<dt><?php echo $_helper->__("Phone");?>:</dt> 
						<dd><?php echo $this->escapeHtml($_shippingAddress->getTelephone()); ?> </dd> 
						<dt><?php echo $_helper->__("Bank account");?>:</dt> 
						<dd><?php echo $this->__("N/A");?> [dev] </dd> 
					</dl>
				</div>
			</div>
		</div>
	</div>
	
	<?php echo $this->getChildHtml('vendor_rma_edit_items');?>
	
	<div class="row">
		<div class="col-md-12">
			<div class="widget box">
				<div class="widget-header"> 
					<h4>
						<i class="icon-comment"></i> 
						<?php echo $_helper->__("Customer notification comment");?>
					</h4>
				</div>
				<div class="widget-content">
					<?php if($_rma->getCommentText()):?>
						<?php echo nl2br($this->escapeHtml($_rma->getCommentText()));?>
					<?php else:?>
						<span class="text-muted"><?php echo $_helper->__("No comment");?></span>
					<?php endif;?>
				</div>
			</div>
		</div>
	</div>
	
	<div class="row">
		<div class="col-md-8">
			<div class="widget box">
				<div class="widget-header"> 
					<h4>
						<i class="icon-comments-alt"></i> 
						<?php echo $_helper->__("History");?>
					</h4>
				</div>
				<div class="widget-content">
					<?php if($_comments->count()):?>
					<dl class="dl-horizontal">
						<?php foreach ($_comments as $_c): ?>
						<dt>
							<?php echo Mage::helper('core')->formatDate($_c->getCreatedAt(), 'medium', true) ?>
							<br/>
							<small class="text-muted" style="font-weight: normal;">
								<?php echo $this->htmlEscape($_c->getRmaStatusName());?>
							</small>
						</dt>
						<dd>
							[<?php echo $this->htmlEscape($_c->getAuthorTypeText());?>]
							<?php echo nl2br($this->htmlEscape($_c->getComment()));?>
						</dd>
						
						<?php endforeach ?>
					</dl>
					<?php else:?>
						<span class="text-muted"><?php echo $_helper->__("No comment");?></span>
					<?php endif;?>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="widget box">
				<div class="widget-header"> 
					<h4>
						<i class="icon-pencil"></i> 
						<?php echo $_helper->__("Change status / add comment");?>
					</h4>
				</div>
				<div class="widget-content">
					<form class="form-horizontal row-border " action="<?php echo $this->getRmaUrl("comment");?>">
						<div class="form-group">
							<label class="control-label col-md-3">
								<?php echo $_helper->__("Status");?>
							</label>
							<div class="col-md-9">
								<select class="form-control">
									<?php foreach($_statuses as $_statusId=>$_label):?>
									<option value="<?php echo $this->escapeHtml($_statusId)?>" <?php if($_currentStatusId==$_statusId):?>selected="selected"<?php endif;?>><?php echo $this->escapeHtml($_label) ?></option>
									<?php endforeach;?>
								</select>
							</div>
						</div>
						<div class="form-group">
							<div class="col-md-12">
								<textarea class="form-control" rows="8"></textarea>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-md-3">
								<?php echo $_helper->__("Notify cust.");?>
							</label>
							<div class="col-md-9">
								<label class="checkbox"> 
									<input type="checkbox" value=""> 
								</label>
							</div>
						</div>
						<div class="form-actions"> <input type="submit" value="<?php echo $_helper->__("Save");?>" class="btn btn-primary pull-right"> </div>
					</form>
				</div>
			</div>
			
			<div class="widget box">
				<div class="widget-header"> 
					<h4>
						<i class="icon-pencil"></i> 
						<?php echo $_helper->__("Shipping confirmation");?>
					</h4>
				</div>
				<div class="widget-content">
					<form class="form-horizontal row-border " action="<?php echo $this->getRmaUrl("comment");?>">
						<div class="form-group">
							<div class="col-md-12">
								<dl class="dl-horizontal dl-z">
									<dt><?php echo $_helper->__("Shpping letter");?>:</dt>
									<dd>1212313123 [dev]</dd>
									<dt><?php echo $_helper->__("Sent date");?>:</dt>
									<dd><?php echo $this->formatDate();?></dd>
									<dt><?php echo $_helper->__("Carrier");?>:</dt>
									<dd>DHL [dev]</dd>
									<dt><?php echo $_helper->__("Status");?>:</dt>
									<dd>Odebrane [dev]</dd>
								</dl>
							</div>
						</div>
						
						<div class="form-group">
							<div class="col-md-12">
								<dl class="dl-horizontal dl-z">
									<dt><?php echo $_helper->__("Shpping letter");?>:</dt>
									<dd>1212313123 [dev]</dd>
									<dt><?php echo $_helper->__("Sent date");?>:</dt>
									<dd><?php echo $this->formatDate();?></dd>
									<dt><?php echo $_helper->__("Carrier");?>:</dt>
									<dd>DHL [dev]</dd>
									<dt><?php echo $_helper->__("Status");?>:</dt>
									<dd>Odebrane [dev]</dd>
								</dl>
							</div>
						</div>
						
						<div class="form-actions"> <input type="submit" value="<?php echo $_helper->__("Confirm shipping");?>" class="btn btn-primary pull-right"> </div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
<?php  
/*******************************************************************************
 *	Shippign address modal
 *******************************************************************************/
	echo $this->getChild("vendor_rma_edit_shipping_address")->
		setAddress($_shippingAddress)->
		toHtml();
?>
<?php  /*
<div class="container">
	<form id="edit-pos" class="form-horizontal row-border" action="<?php echo $this->getForm()->getAction();?>" method="POST">
		<input type="hidden" name="pos_id" value="<?php echo $_pos->getId();?>"/>
		<?php echo $this->getLayout()->getBlock('formkey')->toHtml();?>
		<?php echo $this->getFormHtml();?>
		<div class="form-actions"> <input type="submit" value="<?php echo $_helper->__("Save");?>" class="btn btn-primary pull-right"> </div>
	</form>
</div> */ ?>