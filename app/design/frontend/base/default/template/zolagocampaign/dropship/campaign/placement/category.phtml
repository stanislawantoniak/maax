<?php
$bannerHelper = Mage::helper('zolagobanner');
$bannerTypes = $bannerHelper->getBannersConfiguration();
$vendor = Mage::getSingleton('udropship/session')->getVendor();

//$campaigns = $this->getCampaigns();
//Zend_Debug::dump($campaigns);
?>
<div class="container">
    <div class="page-heading row">
        <div class="col-lg-6">
            <h3><span data-source="category">Women's clothing</span></h3>
        </div>
    </div>
    <?php if (!empty($bannerTypes)): ?>
        <?php foreach ($bannerTypes as $bannerType): ?>
            <?php if (!empty($bannerType->position_count)): ?>
            <div class="row">
                <!--=== Example Box ===-->
                <div class="col-md-12">
                    <div class="widget box">
                        <div class="widget-header">
                            <h4><i class="icon-pin-flag"></i> <span data-source="banner-type"><?php echo $bannerType->title; ?></span></h4>
                            <div class="toolbar no-padding"> <div class="btn-group"> <span class="btn btn-xs widget-collapse"><i class="icon-angle-down"></i></span> </div> </div>
                        </div>
                        <div class="widget-content banner-type" style="display: block;">

                                <?php for($i=1; $i<= $bannerType->position_count; $i++): ?>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <?php echo $bannerType->position_label; ?> <span data-source="position"><?php echo $i; ?></span>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="align-right">
                                                drag to change order - priority

                                                <a href="#" class="btn btn-primary"
                                                   data-toggle="modal"
                                                   data-target="#basicModal"><i class="icon-plus-sign"></i><span><span> <?php echo $this->__('Add'); ?></span></span></a>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="col-md-3 banner-item">
                                                <h5>Campaign Name</h5>
                                                <h5>Vendor Name</h5>
                                                <div class="dates">
                                                    <i class="icon-warning-sign"></i> 01.07.2014 12:00 - 01.08.2014 12:00
                                                </div>
                                            </div>
                                        </div>

<!--                                            --><?php //$titleCode = Mage::getSingleton('zolagobanner/banner_type')->getTypCodeByTitle($bannerType->title); echo $titleCode;?>
<!--                                            --><?php //if (isset($campaigns[$titleCode]) && !empty($campaigns[$titleCode])): ?>
<!--                                                --><?php //foreach ($campaigns[$titleCode] as $campaign): ?>
<!--                                                    <div class="col-md-6">-->
<!--                                                        <h4>--><?php //echo $campaign->name; ?><!--</h4>-->
<!--                                                        <h4>--><?php //echo $vendor->getName(); ?><!--</h4>-->
<!--                                                        --><?php //Zend_Debug::dump($campaign->getData()); ?>
<!--                                                    </div>-->
<!--                                                --><?php //endforeach; ?>
<!--                                            --><?php //endif; ?>

                                        <br /><br /><br />
                                    </div>
                                <?php endfor; ?>

                        </div>
                    </div>
                </div> <!-- /.col-md-12 -->
                <!-- /Example Box -->
            </div>
            <?php endif; ?>
        <?php endforeach; ?>
    <?php endif; ?>
</div>


<div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                <h4 class="modal-title" id="myModalLabel">
                    Add new creative for:
                    <span data-val="category"></span>
                    - <span data-val="banner-type"></span> - <span data-val="position"></span>
                </h4>
            </div>
            <div class="modal-body row">
                <div class="col-md-6">
                    <div class="row">
                        <label>Choose campaign: </label>
                        <select name="campaign">
                            <option value="1">Campaign Name</option>
                            <option value="2">Campaign Name 2</option>
                            <option value="3">Campaign Name 3</option>
                        </select>
                    </div>
                    <div class="row">
                        <label>Choose creative: </label>
                        <select name="banner">
                            <option value="1">Creative 1</option>
                            <option value="2">Creative 2</option>
                            <option value="3">Creative 3</option>
                        </select>
                    </div>
                    <div class="row">
                        <label>Set priority: </label>
                        <select name="priority">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <label>Preview: </label>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    jQuery(function ($) {
        $("#basicModal").on("show.bs.modal", function (e) {
            var category = $('[data-source="category"]').html();
            var bannerType = $(e.relatedTarget).parents('.widget').find('[data-source="banner-type"]').html();
            var position = $(e.relatedTarget).parents('.widget .row').find('[data-source="position"]').html();

            $(this).find('[data-val="category"]').html(category);
            $(this).find('[data-val="banner-type"]').html(bannerType);
            $(this).find('[data-val="position"]').html(position);

            $(e.relatedTarget).parents('.row').find('.col-md-12').append("<div data-targ='add'></div>");

        });

        $("#basicModal").on("hide.bs.modal", function (e) {
            $(this).find('[data-val="category"]').html('');
            $(this).find('[data-val="banner-type"]').html('');
            $(this).find('[data-val="position"]').html('');
        });
        $('#basicModal .btn.btn-primary').click(function(){
            var category = $('#basicModal').find('[name=campaign] option:selected').val();
            var categoryName = jQuery('#basicModal').find('[name=campaign] option:selected').text();
            var bannerType = $('#basicModal').find('[name=banner] option:selected').val();
            var position = $('#basicModal').find('[name=priority] option:selected').val();
            console.log(category,categoryName,bannerType,position);

            var campaignBlock = '<div class="col-md-3 banner-item">' +
                "<h5>"+categoryName+"</h5>" +
                "<h5>Vendor Name</h5>" +
                '<div class="dates">' +
                '<i class="icon-warning-sign"></i> 01.07.2014 12:00 - 01.08.2014 12:00' +
                '</div>' +
                '</div>';
            console.log($(this).parents('.row'));
            $('[data-targ="add"]').replaceWith(campaignBlock);
        })
    })
</script>